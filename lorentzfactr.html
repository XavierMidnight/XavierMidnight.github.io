<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/comfy.js@latest/dist/comfy.min.js"></script>

    <link href="https://cdn.muicss.com/mui-0.10.3/css/mui.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.muicss.com/mui-0.10.3/js/mui.min.js"></script>


    <style>
     table { border-collapse:collapse }
      td{width:30px;height:30px; font-size: 0;}
      
      tr:nth-child(2n+1) td:nth-child(2n+1) {background: rgb(216, 216, 216)}
      tr:nth-child(2n+2) td:nth-child(2n+2) {background: rgb(216, 216, 216)}

      tr:nth-child(2n+1) td:nth-child(2n+2) {background: rgb(230, 230, 255)}
      tr:nth-child(2n+2) td:nth-child(2n+1) {background: rgb(230, 230, 255)}
      </style>

  </head>
  <body onmouseup="down=false" onmousedown="down=true">
 
    <script type="text/javascript">
     
      
      function init(){
        ComfyJS.Init( "lorentzfactr",document.getElementById('token').value );

        ComfyJS.onChat = ( user, message, flags, self, extra ) => {
          var chatBox = document.getElementById("chatBox");
          chatBox.innerHTML += "<span><span style='color:"+getRandomColor()+";font-weight:bold'>"+ user+"</span>: "+message+ "</span><br>"
          chatBox.scrollTop = chatBox.scrollHeight;
        }
      }

      function say(){
        var chatBox = document.getElementById("chatBox");
        var user = "LedCommand";
        var anchors = document.getElementsByTagName('td');
            for(var i = 0; i < anchors.length; i++) {
              var anchor = anchors[i];
              var str = anchor.style.backgroundColor;
              var res = str.replace("rgb(", "");
              res = res.replace(")", "");
              if(res!=""){
                var message = "!LedColor("+anchor.outerText+","+res+")";
                console.log(message);
                chatBox.innerHTML += "<span><span style='color:"+getRandomColor()+";font-weight:bold'>"+ user+"</span>: "+message+ "</span><br>"   // Comment this line when you uncomment the line below
                // ComfyJS.Say( messagee );   // Uncomment this command to spam the chat with led commands  
              }
            }
            chatBox.scrollTop = chatBox.scrollHeight;
           
        
        
        
      }

     var tool = "pencil";
     var down= "false";



      function pencil(what){

        if(tool=="pencil"){
        what.style.backgroundColor = document.getElementById("html5colorpicker").value;
        }else if(tool=="bucket"){
          var colorToReplace = what.style.backgroundColor;
          var anchors = document.getElementsByTagName('td');
            for(var i = 0; i < anchors.length; i++) {
              var anchor = anchors[i];
              if(anchor.style.backgroundColor==colorToReplace){
                anchor.style.backgroundColor = document.getElementById("html5colorpicker").value;
              }
            }
        }else if(tool=="picker"){

        var h = rgb2hex(what.style.backgroundColor);
          document.getElementById("html5colorpicker").value = h;
        }
      }

      function brush(what){

        
        if(tool=="brush" && down==true){
        what.style.backgroundColor = document.getElementById("html5colorpicker").value;
        }
      }
      
      const rgb2hex = (rgb) => `#${rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/).slice(1).map(n => parseInt(n, 10).toString(16).padStart(2, '0')).join('')}`
      

      const colToHex = (c) => {
  // Hack so colors are bright enough
  let color = (c < 75) ? c + 75 : c
  let hex = color.toString(16);
  return hex.length == 1 ? "0" + hex : hex;
}

// uses colToHex to concatenate
// a full 6 digit hex code
const rgbToHex = (r,g,b) => {
  return "#" + colToHex(r) + colToHex(g) + colToHex(b);
}

// Returns three random 0-255 integers
const getRandomColor = () => {
  return rgbToHex(
    Math.floor(Math.random() * 255),
    Math.floor(Math.random() * 255),
    Math.floor(Math.random() * 255));
}

    </script>


<div style="width:200px;display:inline-block">
    
  Change Color<br>
  <input type="color" id="html5colorpicker"  value="#ff0000" style="height:75;width:75px;"><br><br><br><br>
    
    <label class="mui-btn mui-btn--raised" for="pencil">Pencil</label>
    <input type="radio" class="" name="tool" id="pencil" onclick="tool='pencil'" checked>

    <label class="mui-btn mui-btn--raised" for="brush">Brush</label>
    <input type="radio" class="" name="tool" id="brush"  onclick="tool='brush'">

    <label class="mui-btn mui-btn--raised" for="bucket">Color Replace</label>
    <input type="radio" class="" name="tool" id="bucket" onclick="tool='bucket'">

    <label class="mui-btn mui-btn--raised" for="picker">Color Picker</label>
    <input type="radio" class="" name="tool" id="picker" onclick="tool='picker'">    
   
</div>

<table style="display:inline-block">
  <tr><td >0,15</td><td >1,15</td><td>2,15</td><td>3,15</td><td>4,15</td><td>5,15</td><td>6,15</td><td>7,15</td><td>8,15</td><td>9,15</td><td>10,15</td><td>11,15</td><td>12,15</td><td>13,15</td><td>14,15</td><td>15,15</td></tr> 
  <tr><td >0,14</td><td >1,14</td><td>2,14</td><td>3,14</td><td>4,14</td><td>5,14</td><td>6,14</td><td>7,14</td><td>8,14</td><td>9,14</td><td>10,14</td><td>11,14</td><td>12,14</td><td>13,14</td><td>14,14</td><td>15,14</td></tr> 
  <tr><td >0,13</td><td >1,13</td><td>2,13</td><td>3,13</td><td>4,13</td><td>5,13</td><td>6,13</td><td>7,13</td><td>8,13</td><td>9,13</td><td>10,13</td><td>11,13</td><td>12,13</td><td>13,13</td><td>14,13</td><td>15,13</td></tr> 
  <tr><td >0,12</td><td >1,12</td><td>2,12</td><td>3,12</td><td>4,12</td><td>5,12</td><td>6,12</td><td>7,12</td><td>8,12</td><td>9,12</td><td>10,12</td><td>11,12</td><td>12,12</td><td>13,12</td><td>14,12</td><td>15,12</td></tr> 
  <tr><td >0,11</td><td >1,11</td><td>2,11</td><td>3,11</td><td>4,11</td><td>5,11</td><td>6,11</td><td>7,11</td><td>8,11</td><td>9,11</td><td>10,11</td><td>11,11</td><td>12,11</td><td>13,11</td><td>14,11</td><td>15,11</td></tr> 
  <tr><td >0,10</td><td >1,10</td><td>2,10</td><td>3,10</td><td>4,10</td><td>5,10</td><td>6,10</td><td>7,10</td><td>8,10</td><td>9,10</td><td>10,10</td><td>11,10</td><td>12,10</td><td>13,10</td><td>14,10</td><td>15,10</td></tr> 
  <tr><td >0,9</td><td >1,9</td><td>2,9</td><td>3,9</td><td>4,9</td><td>5,9</td><td>6,9</td><td>7,9</td><td>8,9</td><td>9,9</td><td>10,9</td><td>11,9</td><td>12,9</td><td>13,9</td><td>14,9</td><td>15,9</td></tr> 
  <tr><td >0,8</td><td >1,8</td><td>2,8</td><td>3,8</td><td>4,8</td><td>5,8</td><td>6,8</td><td>7,8</td><td>8,8</td><td>9,8</td><td>10,8</td><td>11,8</td><td>12,8</td><td>13,8</td><td>14,8</td><td>15,8</td></tr> 
  <tr><td >0,7</td><td >1,7</td><td>2,7</td><td>3,7</td><td>4,7</td><td>5,7</td><td>6,7</td><td>7,7</td><td>8,7</td><td>9,7</td><td>10,7</td><td>11,7</td><td>12,7</td><td>13,7</td><td>14,7</td><td>15,7</td></tr> 
  <tr><td >0,6</td><td >1,6</td><td>2,6</td><td>3,6</td><td>4,6</td><td>5,6</td><td>6,6</td><td>7,6</td><td>8,6</td><td>9,6</td><td>10,6</td><td>11,6</td><td>12,6</td><td>13,6</td><td>14,6</td><td>15,6</td></tr> 
  <tr><td >0,5</td><td >1,5</td><td>2,5</td><td>3,5</td><td>4,5</td><td>5,5</td><td>6,5</td><td>7,5</td><td>8,5</td><td>9,5</td><td>10,5</td><td>11,5</td><td>12,5</td><td>13,5</td><td>14,5</td><td>15,5</td></tr> 
  <tr><td >0,4</td><td >1,4</td><td>2,4</td><td>3,4</td><td>4,4</td><td>5,4</td><td>6,4</td><td>7,4</td><td>8,4</td><td>9,4</td><td>10,4</td><td>11,4</td><td>12,4</td><td>13,4</td><td>14,4</td><td>15,4</td></tr> 
  <tr><td >0,3</td><td >1,3</td><td>2,3</td><td>3,3</td><td>4,3</td><td>5,3</td><td>6,3</td><td>7,3</td><td>8,3</td><td>9,3</td><td>10,3</td><td>11,3</td><td>12,3</td><td>13,3</td><td>14,3</td><td>15,3</td></tr> 
  <tr><td >0,2</td><td >1,2</td><td>2,2</td><td>3,2</td><td>4,2</td><td>5,2</td><td>6,2</td><td>7,2</td><td>8,2</td><td>9,2</td><td>10,2</td><td>11,2</td><td>12,2</td><td>13,2</td><td>14,2</td><td>15,2</td></tr> 
  <tr><td >0,1</td><td >1,1</td><td>2,1</td><td>3,1</td><td>4,1</td><td>5,1</td><td>6,1</td><td>7,1</td><td>8,1</td><td>9,1</td><td>10,1</td><td>11,1</td><td>12,1</td><td>13,1</td><td>14,1</td><td>15,1</td></tr> 
  <tr><td >0,0</td><td >1,0</td><td>2,0</td><td>3,0</td><td>4,0</td><td>5,0</td><td>6,0</td><td>7,0</td><td>8,0</td><td>9,0</td><td>10,0</td><td>11,0</td><td>12,0</td><td>13,0</td><td>14,0</td><td>15,0</td></tr> 
</table>





<script>
var anchors = document.getElementsByTagName('td');
        for(var i = 0; i < anchors.length; i++) {
            var anchor = anchors[i];
            anchor.onclick = function() {
                pencil(this);
            }
          

            anchor.onmousemove = function() {
                  brush(this);
            }
 
        }



</script>

<div style="display:inline-block;width:400px">
  
<a href="http://twitchapps.com/tmi/" target="_blank">Get Your Twitch Token to Send commands</a>
<input id="token" type="text"/> <button onclick="document.getElementById('token').style.display = 'none'; this.innerText = 'Token Saved';this.disabled=true;init()">Save</button>


  Lorentzfactr Chat Box

  <div id="chatBox" style="overflow: auto;height:400px;width:400px;border:1px solid;padding:10px"></div>
<button onclick="say()" class="mui-btn mui-btn--raised mui-btn--primary">Send To LED Display</button>
</div>
</br>
</br>
<div style=" position:absolute;bottom:0px">
libraries used
<a href="https://github.com/instafluff/ComfyJS">ComfyJS</a>
</div>
  </body>
</html>